!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leancloud-realtime")):"function"==typeof define&&define.amd?define("webrtc",["exports","leancloud-realtime"],e):e(t.AV=t.AV||{},t.AV)}(this,function(t,e){"use strict";function n(t){return t&&t.__esModule?t.default:t}function r(t,e){return e={exports:{}},t(e,e.exports),e.exports}function o(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r}),this.resolve=y(e),this.reject=y(n)}var i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},c=function(){},s=function(t,e){return{value:e,done:!!t}},a={},u={}.toString,f=function(t){return u.call(t).slice(8,-1)},l=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==f(t)?t.split(""):Object(t)},p=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},h=function(t){return l(p(t))},d=r(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),v=r(function(t){var e=t.exports={version:"2.5.1"};"number"==typeof __e&&(__e=e)}),y=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},_=function(t,e,n){if(y(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}},m=function(t){return"object"==typeof t?null!==t:"function"==typeof t},g=function(t){if(!m(t))throw TypeError(t+" is not an object!");return t},b=function(t){try{return!!t()}catch(t){return!0}},w=!b(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),C=d.document,S=m(C)&&m(C.createElement),O=function(t){return S?C.createElement(t):{}},E=!w&&!b(function(){return 7!=Object.defineProperty(O("div"),"a",{get:function(){return 7}}).a}),A=function(t,e){if(!m(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!m(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!m(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!m(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},T=Object.defineProperty,P={f:w?Object.defineProperty:function(t,e,n){if(g(t),e=A(e,!0),g(n),E)try{return T(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},j=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},x=w?function(t,e,n){return P.f(t,e,j(1,n))}:function(t,e,n){return t[e]=n,t},L=function(t,e,n){var r,o,i,c=t&L.F,s=t&L.G,a=t&L.S,u=t&L.P,f=t&L.B,l=t&L.W,p=s?v:v[e]||(v[e]={}),h=p.prototype,y=s?d:a?d[e]:(d[e]||{}).prototype;s&&(n=e);for(r in n)(o=!c&&y&&void 0!==y[r])&&r in p||(i=o?y[r]:n[r],p[r]=s&&"function"!=typeof y[r]?n[r]:f&&o?_(i,d):l&&y[r]==i?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(i):u&&"function"==typeof i?_(Function.call,i):i,u&&((p.virtual||(p.virtual={}))[r]=i,t&L.R&&h&&!h[r]&&x(h,r,i)))};L.F=1,L.G=2,L.S=4,L.P=8,L.B=16,L.W=32,L.U=64,L.R=128;var I=L,M=x,R={}.hasOwnProperty,N=function(t,e){return R.call(t,e)},D=Math.ceil,k=Math.floor,F=function(t){return isNaN(t=+t)?0:(t>0?k:D)(t)},W=Math.min,V=function(t){return t>0?W(F(t),9007199254740991):0},G=Math.max,K=Math.min,B=function(t,e){return(t=F(t))<0?G(t+e,0):K(t,e)},Y=d["__core-js_shared__"]||(d["__core-js_shared__"]={}),q=function(t){return Y[t]||(Y[t]={})},U=0,H=Math.random(),J=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++U+H).toString(36))},z=q("keys"),Q=function(t){return z[t]||(z[t]=J(t))},X=function(t){return function(e,n,r){var o,i=h(e),c=V(i.length),s=B(r,c);if(t&&n!=n){for(;c>s;)if((o=i[s++])!=o)return!0}else for(;c>s;s++)if((t||s in i)&&i[s]===n)return t||s||0;return!t&&-1}}(!1),Z=Q("IE_PROTO"),$=function(t,e){var n,r=h(t),o=0,i=[];for(n in r)n!=Z&&N(r,n)&&i.push(n);for(;e.length>o;)N(r,n=e[o++])&&(~X(i,n)||i.push(n));return i},tt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),et=Object.keys||function(t){return $(t,tt)},nt=w?Object.defineProperties:function(t,e){g(t);for(var n,r=et(e),o=r.length,i=0;o>i;)P.f(t,n=r[i++],e[n]);return t},rt=d.document,ot=rt&&rt.documentElement,it=Q("IE_PROTO"),ct=function(){},st=function(){var t,e=O("iframe"),n=tt.length;for(e.style.display="none",ot.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),st=t.F;n--;)delete st.prototype[tt[n]];return st()},at=Object.create||function(t,e){var n;return null!==t?(ct.prototype=g(t),n=new ct,ct.prototype=null,n[it]=t):n=st(),void 0===e?n:nt(n,e)},ut=r(function(t){var e=q("wks"),n=d.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:J)("Symbol."+t))}).store=e}),ft=P.f,lt=ut("toStringTag"),pt=function(t,e,n){t&&!N(t=n?t:t.prototype,lt)&&ft(t,lt,{configurable:!0,value:e})},ht={};x(ht,ut("iterator"),function(){return this});var dt=function(t,e,n){t.prototype=at(ht,{next:j(1,n)}),pt(t,e+" Iterator")},vt=function(t){return Object(p(t))},yt=Q("IE_PROTO"),_t=Object.prototype,mt=Object.getPrototypeOf||function(t){return t=vt(t),N(t,yt)?t[yt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?_t:null},gt=ut("iterator"),bt=!([].keys&&"next"in[].keys()),wt=function(){return this},Ct=function(t,e,n,r,o,i,c){dt(n,e,r);var s,u,f,l=function(t){if(!bt&&t in v)return v[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},p=e+" Iterator",h="values"==o,d=!1,v=t.prototype,y=v[gt]||v["@@iterator"]||o&&v[o],_=y||l(o),m=o?h?l("entries"):_:void 0,g="Array"==e?v.entries||y:y;if(g&&(f=mt(g.call(new t)))!==Object.prototype&&f.next&&pt(f,p,!0),h&&y&&"values"!==y.name&&(d=!0,_=function(){return y.call(this)}),c&&(bt||d||!v[gt])&&x(v,gt,_),a[e]=_,a[p]=wt,o)if(s={values:h?_:l("values"),keys:i?_:l("keys"),entries:m},c)for(u in s)u in v||M(v,u,s[u]);else I(I.P+I.F*(bt||d),e,s);return s};Ct(Array,"Array",function(t,e){this._t=h(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,s(1)):"keys"==e?s(0,n):"values"==e?s(0,t[n]):s(0,[n,t[n]])},"values");a.Arguments=a.Array,c(),c(),c();for(var St=ut("toStringTag"),Ot="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),Et=0;Et<Ot.length;Et++){var At=Ot[Et],Tt=d[At],Pt=Tt&&Tt.prototype;Pt&&!Pt[St]&&x(Pt,St,At),a[At]=a.Array}var jt=function(t){return function(e,n){var r,o,i=String(p(e)),c=F(n),s=i.length;return c<0||c>=s?t?"":void 0:(r=i.charCodeAt(c))<55296||r>56319||c+1===s||(o=i.charCodeAt(c+1))<56320||o>57343?t?i.charAt(c):r:t?i.slice(c,c+2):o-56320+(r-55296<<10)+65536}}(!0);Ct(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=jt(e,n),this._i+=t.length,{value:t,done:!1})});var xt,Lt,It,Mt=ut("toStringTag"),Rt="Arguments"==f(function(){return arguments}()),Nt=function(t,e){try{return t[e]}catch(t){}},Dt=function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=Nt(e=Object(t),Mt))?n:Rt?f(e):"Object"==(r=f(e))&&"function"==typeof e.callee?"Arguments":r},kt=ut("iterator"),Ft=v.isIterable=function(t){var e=Object(t);return void 0!==e[kt]||"@@iterator"in e||a.hasOwnProperty(Dt(e))},Wt=r(function(t){t.exports={default:Ft,__esModule:!0}}),Vt=ut("iterator"),Gt=v.getIteratorMethod=function(t){if(void 0!=t)return t[Vt]||t["@@iterator"]||a[Dt(t)]},Kt=v.getIterator=function(t){var e=Gt(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return g(e.call(t))},Bt=r(function(t){t.exports={default:Kt,__esModule:!0}}),Yt=n(r(function(t,e){function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=n(Wt),o=n(Bt);e.default=function(){function t(t,e){var n=[],r=!0,i=!1,c=void 0;try{for(var s,a=(0,o.default)(t);!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){i=!0,c=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw c}}return n}return function(e,n){if(Array.isArray(e))return e;if((0,r.default)(Object(e)))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()})),qt=function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!");return t},Ut=function(t,e,n,r){try{return r?e(g(n)[0],n[1]):e(n)}catch(e){var o=t.return;throw void 0!==o&&g(o.call(t)),e}},Ht=ut("iterator"),Jt=Array.prototype,zt=function(t){return void 0!==t&&(a.Array===t||Jt[Ht]===t)},Qt=r(function(t){var e={},n={},r=t.exports=function(t,r,o,i,c){var s,a,u,f,l=c?function(){return t}:Gt(t),p=_(o,i,r?2:1),h=0;if("function"!=typeof l)throw TypeError(t+" is not iterable!");if(zt(l)){for(s=V(t.length);s>h;h++)if((f=r?p(g(a=t[h])[0],a[1]):p(t[h]))===e||f===n)return f}else for(u=l.call(t);!(a=u.next()).done;)if((f=Ut(u,p,a.value,r))===e||f===n)return f};r.BREAK=e,r.RETURN=n}),Xt=ut("species"),Zt=function(t,e){var n,r=g(t).constructor;return void 0===r||void 0==(n=g(r)[Xt])?e:y(n)},$t=function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}return t.apply(n,e)},te=d.process,ee=d.setImmediate,ne=d.clearImmediate,re=d.MessageChannel,oe=d.Dispatch,ie=0,ce={},se=function(){var t=+this;if(ce.hasOwnProperty(t)){var e=ce[t];delete ce[t],e()}},ae=function(t){se.call(t.data)};ee&&ne||(ee=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return ce[++ie]=function(){$t("function"==typeof t?t:Function(t),e)},xt(ie),ie},ne=function(t){delete ce[t]},"process"==f(te)?xt=function(t){te.nextTick(_(se,t,1))}:oe&&oe.now?xt=function(t){oe.now(_(se,t,1))}:re?(It=(Lt=new re).port2,Lt.port1.onmessage=ae,xt=_(It.postMessage,It,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(xt=function(t){d.postMessage(t+"","*")},d.addEventListener("message",ae,!1)):xt="onreadystatechange"in O("script")?function(t){ot.appendChild(O("script")).onreadystatechange=function(){ot.removeChild(this),se.call(t)}}:function(t){setTimeout(_(se,t,1),0)});var ue={set:ee,clear:ne},fe=ue.set,le=d.MutationObserver||d.WebKitMutationObserver,pe=d.process,he=d.Promise,de="process"==f(pe),ve={f:function(t){return new o(t)}},ye=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},_e=function(t,e){if(g(t),m(e)&&e.constructor===t)return e;var n=ve.f(t);return(0,n.resolve)(e),n.promise},me=ut("species"),ge=ut("iterator"),be=!1;try{var we=[7][ge]();we.return=function(){be=!0},Array.from(we,function(){throw 2})}catch(t){}var Ce,Se,Oe,Ee,Ae=ue.set,Te=function(){var t,e,n,r=function(){var r,o;for(de&&(r=pe.domain)&&r.exit();t;){o=t.fn,t=t.next;try{o()}catch(r){throw t?n():e=void 0,r}}e=void 0,r&&r.enter()};if(de)n=function(){pe.nextTick(r)};else if(le){var o=!0,i=document.createTextNode("");new le(r).observe(i,{characterData:!0}),n=function(){i.data=o=!o}}else if(he&&he.resolve){var c=he.resolve();n=function(){c.then(r)}}else n=function(){fe.call(d,r)};return function(r){var o={fn:r,next:void 0};e&&(e.next=o),t||(t=o,n()),e=o}}(),Pe=d.TypeError,je=d.process,xe=d.Promise,Le="process"==Dt(je),Ie=function(){},Me=Se=ve.f,Re=!!function(){try{var t=xe.resolve(1),e=(t.constructor={})[ut("species")]=function(t){t(Ie,Ie)};return(Le||"function"==typeof PromiseRejectionEvent)&&t.then(Ie)instanceof e}catch(t){}}(),Ne=function(t){var e;return!(!m(t)||"function"!=typeof(e=t.then))&&e},De=function(t,e){if(!t._n){t._n=!0;var n=t._c;Te(function(){for(var r=t._v,o=1==t._s,i=0;n.length>i;)!function(e){var n,i,c=o?e.ok:e.fail,s=e.resolve,a=e.reject,u=e.domain;try{c?(o||(2==t._h&&We(t),t._h=1),!0===c?n=r:(u&&u.enter(),n=c(r),u&&u.exit()),n===e.promise?a(Pe("Promise-chain cycle")):(i=Ne(n))?i.call(n,s,a):s(n)):a(r)}catch(t){a(t)}}(n[i++]);t._c=[],t._n=!1,e&&!t._h&&ke(t)})}},ke=function(t){Ae.call(d,function(){var e,n,r,o=t._v,i=Fe(t);if(i&&(e=ye(function(){Le?je.emit("unhandledRejection",o,t):(n=d.onunhandledrejection)?n({promise:t,reason:o}):(r=d.console)&&r.error&&r.error("Unhandled promise rejection",o)}),t._h=Le||Fe(t)?2:1),t._a=void 0,i&&e.e)throw e.v})},Fe=function(t){if(1==t._h)return!1;for(var e,n=t._a||t._c,r=0;n.length>r;)if((e=n[r++]).fail||!Fe(e.promise))return!1;return!0},We=function(t){Ae.call(d,function(){var e;Le?je.emit("rejectionHandled",t):(e=d.onrejectionhandled)&&e({promise:t,reason:t._v})})},Ve=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),De(e,!0))},Ge=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw Pe("Promise can't be resolved itself");(e=Ne(t))?Te(function(){var r={_w:n,_d:!1};try{e.call(t,_(Ge,r,1),_(Ve,r,1))}catch(t){Ve.call(r,t)}}):(n._v=t,n._s=1,De(n,!1))}catch(t){Ve.call({_w:n,_d:!1},t)}}};Re||(xe=function(t){qt(this,xe,"Promise","_h"),y(t),Ce.call(this);try{t(_(Ge,this,1),_(Ve,this,1))}catch(t){Ve.call(this,t)}},(Ce=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=function(t,e,n){for(var r in e)n&&t[r]?t[r]=e[r]:x(t,r,e[r]);return t}(xe.prototype,{then:function(t,e){var n=Me(Zt(this,xe));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=Le?je.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&De(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),Oe=function(){var t=new Ce;this.promise=t,this.resolve=_(Ge,t,1),this.reject=_(Ve,t,1)},ve.f=Me=function(t){return t===xe||t===Ee?new Oe(t):Se(t)}),I(I.G+I.W+I.F*!Re,{Promise:xe}),pt(xe,"Promise"),function(t){var e="function"==typeof v[t]?v[t]:d[t];w&&e&&!e[me]&&P.f(e,me,{configurable:!0,get:function(){return this}})}("Promise"),Ee=v.Promise,I(I.S+I.F*!Re,"Promise",{reject:function(t){var e=Me(this);return(0,e.reject)(t),e.promise}}),I(I.S+!0*I.F,"Promise",{resolve:function(t){return _e(this===Ee?xe:this,t)}}),I(I.S+I.F*!(Re&&function(t,e){if(!e&&!be)return!1;var n=!1;try{var r=[7],o=r[ge]();o.next=function(){return{done:n=!0}},r[ge]=function(){return o},t(r)}catch(t){}return n}(function(t){xe.all(t).catch(Ie)})),"Promise",{all:function(t){var e=this,n=Me(e),r=n.resolve,o=n.reject,i=ye(function(){var n=[],i=0,c=1;Qt(t,!1,function(t){var s=i++,a=!1;n.push(void 0),c++,e.resolve(t).then(function(t){a||(a=!0,n[s]=t,--c||r(n))},o)}),--c||r(n)});return i.e&&o(i.v),n.promise},race:function(t){var e=this,n=Me(e),r=n.reject,o=ye(function(){Qt(t,!1,function(t){e.resolve(t).then(n.resolve,r)})});return o.e&&r(o.v),n.promise}}),I(I.P+I.R,"Promise",{finally:function(t){var e=Zt(this,v.Promise||d.Promise),n="function"==typeof t;return this.then(n?function(n){return _e(e,t()).then(function(){return n})}:t,n?function(n){return _e(e,t()).then(function(){throw n})}:t)}}),I(I.S,"Promise",{try:function(t){var e=ve.f(this),n=ye(t);return(n.e?e.reject:e.resolve)(n.v),e.promise}});var Ke=v.Promise,Be=n(r(function(t){t.exports={default:Ke,__esModule:!0}})),Ye={f:Object.getOwnPropertySymbols},qe={f:{}.propertyIsEnumerable},Ue=Object.assign,He=!Ue||b(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=Ue({},t)[n]||Object.keys(Ue({},e)).join("")!=r})?function(t,e){for(var n=vt(t),r=arguments.length,o=1,i=Ye.f,c=qe.f;r>o;)for(var s,a=l(arguments[o++]),u=i?et(a).concat(i(a)):et(a),f=u.length,p=0;f>p;)c.call(a,s=u[p++])&&(n[s]=a[s]);return n}:Ue;I(I.S+I.F,"Object",{assign:He});var Je=v.Object.assign,ze=n(r(function(t){t.exports={default:Je,__esModule:!0}})),Qe=n(r(function(t,e){e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}})),Xe={f:ut},Ze=Xe.f("iterator"),$e=r(function(t){t.exports={default:Ze,__esModule:!0}}),tn=r(function(t){var e=J("meta"),n=P.f,r=0,o=Object.isExtensible||function(){return!0},i=!b(function(){return o(Object.preventExtensions({}))}),c=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},s=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!m(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!N(t,e)){if(!o(t))return"F";if(!n)return"E";c(t)}return t[e].i},getWeak:function(t,n){if(!N(t,e)){if(!o(t))return!0;if(!n)return!1;c(t)}return t[e].w},onFreeze:function(t){return i&&s.NEED&&o(t)&&!N(t,e)&&c(t),t}}}),en=P.f,nn=function(t){var e=v.Symbol||(v.Symbol={});"_"==t.charAt(0)||t in e||en(e,t,{value:Xe.f(t)})},rn=function(t){var e=et(t),n=Ye.f;if(n)for(var r,o=n(t),i=qe.f,c=0;o.length>c;)i.call(t,r=o[c++])&&e.push(r);return e},on=Array.isArray||function(t){return"Array"==f(t)},cn=tt.concat("length","prototype"),sn={f:Object.getOwnPropertyNames||function(t){return $(t,cn)}},an=sn.f,un={}.toString,fn="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ln=function(t){try{return an(t)}catch(t){return fn.slice()}},pn={f:function(t){return fn&&"[object Window]"==un.call(t)?ln(t):an(h(t))}},hn=Object.getOwnPropertyDescriptor,dn={f:w?hn:function(t,e){if(t=h(t),e=A(e,!0),E)try{return hn(t,e)}catch(t){}if(N(t,e))return j(!qe.f.call(t,e),t[e])}},vn=tn.KEY,yn=dn.f,_n=P.f,mn=pn.f,gn=d.Symbol,bn=d.JSON,wn=bn&&bn.stringify,Cn=ut("_hidden"),Sn=ut("toPrimitive"),On={}.propertyIsEnumerable,En=q("symbol-registry"),An=q("symbols"),Tn=q("op-symbols"),Pn=Object.prototype,jn="function"==typeof gn,xn=d.QObject,Ln=!xn||!xn.prototype||!xn.prototype.findChild,In=w&&b(function(){return 7!=at(_n({},"a",{get:function(){return _n(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=yn(Pn,e);r&&delete Pn[e],_n(t,e,n),r&&t!==Pn&&_n(Pn,e,r)}:_n,Mn=function(t){var e=An[t]=at(gn.prototype);return e._k=t,e},Rn=jn&&"symbol"==typeof gn.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof gn},Nn=function(t,e,n){return t===Pn&&Nn(Tn,e,n),g(t),e=A(e,!0),g(n),N(An,e)?(n.enumerable?(N(t,Cn)&&t[Cn][e]&&(t[Cn][e]=!1),n=at(n,{enumerable:j(0,!1)})):(N(t,Cn)||_n(t,Cn,j(1,{})),t[Cn][e]=!0),In(t,e,n)):_n(t,e,n)},Dn=function(t,e){g(t);for(var n,r=rn(e=h(e)),o=0,i=r.length;i>o;)Nn(t,n=r[o++],e[n]);return t},kn=function(t){var e=On.call(this,t=A(t,!0));return!(this===Pn&&N(An,t)&&!N(Tn,t))&&(!(e||!N(this,t)||!N(An,t)||N(this,Cn)&&this[Cn][t])||e)},Fn=function(t,e){if(t=h(t),e=A(e,!0),t!==Pn||!N(An,e)||N(Tn,e)){var n=yn(t,e);return!n||!N(An,e)||N(t,Cn)&&t[Cn][e]||(n.enumerable=!0),n}},Wn=function(t){for(var e,n=mn(h(t)),r=[],o=0;n.length>o;)N(An,e=n[o++])||e==Cn||e==vn||r.push(e);return r},Vn=function(t){for(var e,n=t===Pn,r=mn(n?Tn:h(t)),o=[],i=0;r.length>i;)!N(An,e=r[i++])||n&&!N(Pn,e)||o.push(An[e]);return o};jn||(M((gn=function(){if(this instanceof gn)throw TypeError("Symbol is not a constructor!");var t=J(arguments.length>0?arguments[0]:void 0),e=function(n){this===Pn&&e.call(Tn,n),N(this,Cn)&&N(this[Cn],t)&&(this[Cn][t]=!1),In(this,t,j(1,n))};return w&&Ln&&In(Pn,t,{configurable:!0,set:e}),Mn(t)}).prototype,"toString",function(){return this._k}),dn.f=Fn,P.f=Nn,sn.f=pn.f=Wn,qe.f=kn,Ye.f=Vn,Xe.f=function(t){return Mn(ut(t))}),I(I.G+I.W+I.F*!jn,{Symbol:gn});for(var Gn="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Kn=0;Gn.length>Kn;)ut(Gn[Kn++]);for(var Bn=et(ut.store),Yn=0;Bn.length>Yn;)nn(Bn[Yn++]);I(I.S+I.F*!jn,"Symbol",{for:function(t){return N(En,t+="")?En[t]:En[t]=gn(t)},keyFor:function(t){if(!Rn(t))throw TypeError(t+" is not a symbol!");for(var e in En)if(En[e]===t)return e},useSetter:function(){Ln=!0},useSimple:function(){Ln=!1}}),I(I.S+I.F*!jn,"Object",{create:function(t,e){return void 0===e?at(t):Dn(at(t),e)},defineProperty:Nn,defineProperties:Dn,getOwnPropertyDescriptor:Fn,getOwnPropertyNames:Wn,getOwnPropertySymbols:Vn}),bn&&I(I.S+I.F*(!jn||b(function(){var t=gn();return"[null]"!=wn([t])||"{}"!=wn({a:t})||"{}"!=wn(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!Rn(t)){for(var e,n,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);return"function"==typeof(e=r[1])&&(n=e),!n&&on(e)||(e=function(t,e){if(n&&(e=n.call(this,t,e)),!Rn(e))return e}),r[1]=e,wn.apply(bn,r)}}}),gn.prototype[Sn]||x(gn.prototype,Sn,gn.prototype.valueOf),pt(gn,"Symbol"),pt(Math,"Math",!0),pt(d.JSON,"JSON",!0),nn("asyncIterator"),nn("observable");var qn=v.Symbol,Un=r(function(t){t.exports={default:qn,__esModule:!0}}),Hn=r(function(t,e){function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=n($e),o=n(Un),i="function"==typeof o.default&&"symbol"==typeof r.default?function(t){return typeof t}:function(t){return t&&"function"==typeof o.default&&t.constructor===o.default&&t!==o.default.prototype?"symbol":typeof t};e.default="function"==typeof o.default&&"symbol"===i(r.default)?function(t){return void 0===t?"undefined":i(t)}:function(t){return t&&"function"==typeof o.default&&t.constructor===o.default&&t!==o.default.prototype?"symbol":void 0===t?"undefined":i(t)}}),Jn=n(r(function(t,e){e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(Hn);e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,n.default)(e))&&"function"!=typeof e?t:e}})),zn=function(t,e){if(g(t),!m(e)&&null!==e)throw TypeError(e+": can't set as prototype!")},Qn={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,n){try{(n=_(Function.call,dn.f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,r){return zn(t,r),e?t.__proto__=r:n(t,r),t}}({},!1):void 0),check:zn};I(I.S,"Object",{setPrototypeOf:Qn.set});var Xn=v.Object.setPrototypeOf,Zn=r(function(t){t.exports={default:Xn,__esModule:!0}});I(I.S,"Object",{create:at});var $n=v.Object,tr=function(t,e){return $n.create(t,e)},er=r(function(t){t.exports={default:tr,__esModule:!0}}),nr=n(r(function(t,e){function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=n(Zn),o=n(er),i=n(Hn);e.default=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,i.default)(e)));t.prototype=(0,o.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(r.default?(0,r.default)(t,e):t.__proto__=e)}})),rr=r(function(t){function e(){}function n(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function r(){this._events=new e,this._eventsCount=0}var o=Object.prototype.hasOwnProperty,i="~";Object.create&&(e.prototype=Object.create(null),(new e).__proto__||(i=!1)),r.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)o.call(t,e)&&n.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},r.prototype.listeners=function(t,e){var n=i?i+t:t,r=this._events[n];if(e)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var o=0,c=r.length,s=new Array(c);o<c;o++)s[o]=r[o].fn;return s},r.prototype.emit=function(t,e,n,r,o,c){var s=i?i+t:t;if(!this._events[s])return!1;var a,u,f=this._events[s],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,r),!0;case 5:return f.fn.call(f.context,e,n,r,o),!0;case 6:return f.fn.call(f.context,e,n,r,o,c),!0}for(u=1,a=new Array(l-1);u<l;u++)a[u-1]=arguments[u];f.fn.apply(f.context,a)}else{var p,h=f.length;for(u=0;u<h;u++)switch(f[u].once&&this.removeListener(t,f[u].fn,void 0,!0),l){case 1:f[u].fn.call(f[u].context);break;case 2:f[u].fn.call(f[u].context,e);break;case 3:f[u].fn.call(f[u].context,e,n);break;case 4:f[u].fn.call(f[u].context,e,n,r);break;default:if(!a)for(p=1,a=new Array(l-1);p<l;p++)a[p-1]=arguments[p];f[u].fn.apply(f[u].context,a)}}return!0},r.prototype.on=function(t,e,r){var o=new n(e,r||this),c=i?i+t:t;return this._events[c]?this._events[c].fn?this._events[c]=[this._events[c],o]:this._events[c].push(o):(this._events[c]=o,this._eventsCount++),this},r.prototype.once=function(t,e,r){var o=new n(e,r||this,!0),c=i?i+t:t;return this._events[c]?this._events[c].fn?this._events[c]=[this._events[c],o]:this._events[c].push(o):(this._events[c]=o,this._eventsCount++),this},r.prototype.removeListener=function(t,n,r,o){var c=i?i+t:t;if(!this._events[c])return this;if(!n)return 0==--this._eventsCount?this._events=new e:delete this._events[c],this;var s=this._events[c];if(s.fn)s.fn!==n||o&&!s.once||r&&s.context!==r||(0==--this._eventsCount?this._events=new e:delete this._events[c]);else{for(var a=0,u=[],f=s.length;a<f;a++)(s[a].fn!==n||o&&!s[a].once||r&&s[a].context!==r)&&u.push(s[a]);u.length?this._events[c]=1===u.length?u[0]:u:0==--this._eventsCount?this._events=new e:delete this._events[c]}return this},r.prototype.removeAllListeners=function(t){var n;return t?(n=i?i+t:t,this._events[n]&&(0==--this._eventsCount?this._events=new e:delete this._events[n])):(this._events=new e,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prototype.setMaxListeners=function(){return this},r.prefixed=i,r.EventEmitter=r,t.exports=r});I(I.S+I.F*!w,"Object",{defineProperty:P.f});var or=v.Object,ir=function(t,e,n){return or.defineProperty(t,e,n)},cr=r(function(t){t.exports={default:ir,__esModule:!0}}),sr=n(r(function(t,e){e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(cr);e.default=function(){function t(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),(0,n.default)(t,o.key,o)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}()})),ar=r(function(t,e){!function(){var n={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(t,e){var r="string"==typeof t.initial?{state:t.initial}:t.initial,o=t.terminal||t.final,i=e||t.target||{},c=t.events||[],s=t.callbacks||{},a={},u={},f=function(t){var e=Array.isArray(t.from)?t.from:t.from?[t.from]:[n.WILDCARD];a[t.name]=a[t.name]||{};for(var r=0;r<e.length;r++)u[e[r]]=u[e[r]]||[],u[e[r]].push(t.name),a[t.name][e[r]]=t.to||e[r];t.to&&(u[t.to]=u[t.to]||[])};r&&(r.event=r.event||"startup",f({name:r.event,from:"none",to:r.state}));for(var l=0;l<c.length;l++)f(c[l]);for(var p in a)a.hasOwnProperty(p)&&(i[p]=n.buildEvent(p,a[p]));for(var p in s)s.hasOwnProperty(p)&&(i[p]=s[p]);return i.current="none",i.is=function(t){return Array.isArray(t)?t.indexOf(this.current)>=0:this.current===t},i.can=function(t){return!this.transition&&void 0!==a[t]&&(a[t].hasOwnProperty(this.current)||a[t].hasOwnProperty(n.WILDCARD))},i.cannot=function(t){return!this.can(t)},i.transitions=function(){return(u[this.current]||[]).concat(u[n.WILDCARD]||[])},i.isFinished=function(){return this.is(o)},i.error=t.error||function(t,e,n,r,o,i,c){throw c||i},i.states=function(){return Object.keys(u).sort()},r&&!r.defer&&i[r.event](),i},doCallback:function(t,e,r,o,i,c){if(e)try{return e.apply(t,[r,o,i].concat(c))}catch(e){return t.error(r,o,i,c,n.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",e)}},beforeAnyEvent:function(t,e,r,o,i){return n.doCallback(t,t.onbeforeevent,e,r,o,i)},afterAnyEvent:function(t,e,r,o,i){return n.doCallback(t,t.onafterevent||t.onevent,e,r,o,i)},leaveAnyState:function(t,e,r,o,i){return n.doCallback(t,t.onleavestate,e,r,o,i)},enterAnyState:function(t,e,r,o,i){return n.doCallback(t,t.onenterstate||t.onstate,e,r,o,i)},changeState:function(t,e,r,o,i){return n.doCallback(t,t.onchangestate,e,r,o,i)},beforeThisEvent:function(t,e,r,o,i){return n.doCallback(t,t["onbefore"+e],e,r,o,i)},afterThisEvent:function(t,e,r,o,i){return n.doCallback(t,t["onafter"+e]||t["on"+e],e,r,o,i)},leaveThisState:function(t,e,r,o,i){return n.doCallback(t,t["onleave"+r],e,r,o,i)},enterThisState:function(t,e,r,o,i){return n.doCallback(t,t["onenter"+o]||t["on"+o],e,r,o,i)},beforeEvent:function(t,e,r,o,i){if(!1===n.beforeThisEvent(t,e,r,o,i)||!1===n.beforeAnyEvent(t,e,r,o,i))return!1},afterEvent:function(t,e,r,o,i){n.afterThisEvent(t,e,r,o,i),n.afterAnyEvent(t,e,r,o,i)},leaveState:function(t,e,r,o,i){var c=n.leaveThisState(t,e,r,o,i),s=n.leaveAnyState(t,e,r,o,i);return!1!==c&&!1!==s&&(n.ASYNC===c||n.ASYNC===s?n.ASYNC:void 0)},enterState:function(t,e,r,o,i){n.enterThisState(t,e,r,o,i),n.enterAnyState(t,e,r,o,i)},buildEvent:function(t,e){return function(){var r=this.current,o=e[r]||(e[n.WILDCARD]!=n.WILDCARD?e[n.WILDCARD]:r)||r,i=Array.prototype.slice.call(arguments);if(this.transition)return this.error(t,r,o,i,n.Error.PENDING_TRANSITION,"event "+t+" inappropriate because previous transition did not complete");if(this.cannot(t))return this.error(t,r,o,i,n.Error.INVALID_TRANSITION,"event "+t+" inappropriate in current state "+this.current);if(!1===n.beforeEvent(this,t,r,o,i))return n.Result.CANCELLED;if(r===o)return n.afterEvent(this,t,r,o,i),n.Result.NOTRANSITION;var c=this;this.transition=function(){return c.transition=null,c.current=o,n.enterState(c,t,r,o,i),n.changeState(c,t,r,o,i),n.afterEvent(c,t,r,o,i),n.Result.SUCCEEDED},this.transition.cancel=function(){c.transition=null,n.afterEvent(c,t,r,o,i)};var s=n.leaveState(this,t,r,o,i);return!1===s?(this.transition=null,n.Result.CANCELLED):n.ASYNC===s?n.Result.PENDING:this.transition?this.transition():void 0}}};t.exports&&(e=t.exports=n),e.StateMachine=n}()}),ur=function(){return ar.create({initial:"calling",events:[{name:"connect",from:"calling",to:"connected"},{name:"close",from:"connected",to:"closed"},{name:"cancel",from:"calling",to:"canceled"},{name:"refuse",from:"calling",to:"refused"}]})},fr=r(function(t,e){!function(e){function n(t){var e=f(t);if(y)for(var n,r=0;n=g[r++];)t.hasOwnProperty(n)&&e.push(n);return e}function r(t,e,r){for(var o,i,s=n(r),a=0,u=s.length;a<u;)"__self"!==(o=s[a++])&&(i=r[o],!d(i)||i.prototype&&i.prototype.__self||c&&!(i.toString().indexOf(".__base")>-1)?e[o]=i:e[o]=function(n,r){var o=t[n]?t[n]:"__constructor"===n?e.__self.__parent:v,i=function(){var t=this.__base;this.__base=i.__base;var e=r.apply(this,arguments);return this.__base=t,e};return i.__base=o,i}(o,i))}function o(t,e){for(var n,r=1;n=t[r++];)e?d(n)?i.self(e,n.prototype,n):i.self(e,n):e=d(n)?i(t[0],n.prototype,n):i(t[0],n);return e||t[0]}function i(){var t=arguments,e=h(t[0]),n=e||d(t[0]),i=n?e?o(t[0]):t[0]:s,c=t[n?1:0]||{},a=t[n?2:1],f=c.__constructor||n&&i.prototype&&i.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:n?function(){return i.apply(this,arguments)}:function(){};if(!n)return f.prototype=c,f.prototype.__self=f.prototype.constructor=f,l(f,a);l(f,i),f.__parent=i;var p=i.prototype,v=f.prototype=u(p);return v.__self=v.constructor=f,c&&r(p,v,c),a&&r(i,f,a),f}var c=function(){return"_"}.toString().indexOf("_")>-1,s=function(){},a=Object.prototype.hasOwnProperty,u=Object.create||function(t){var e=function(){};return e.prototype=t,new e},f=Object.keys||function(t){var e=[];for(var n in t)a.call(t,n)&&e.push(n);return e},l=function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);return t},p=Object.prototype.toString,h=Array.isArray||function(t){return"[object Array]"===p.call(t)},d=function(t){return"[object Function]"===p.call(t)},v=function(){},y=!0,_={toString:""};for(var m in _)_.hasOwnProperty(m)&&(y=!1);var g=y?["toString","valueOf"]:null;i.self=function(){var t=arguments,e=h(t[0])?o(t[0],t[0][0]):t[0],n=t[1],i=t[2],c=e.prototype;return n&&r(c,c,n),i&&r(e,e,i),e};var b=!0;t.exports=i,b=!1,"object"==typeof modules&&"function"==typeof modules.define&&(modules.define("inherit",function(t){t(i)}),b=!1),b&&(e.inherit=i)}(i)});if(!e.TypedMessage)throw new Error("LeanCloud Realtime SDK not installed");var lr=fr(e.TypedMessage,{__constructor:function(t){this.__base(),this.payload=t,this.setTransient(!0)}});e.messageField("payload")(lr);var pr,hr,dr,vr,yr,_r,mr,gr,br,wr,Cr=(pr=e.messageType(-102))(hr=function(t){function e(){return Qe(this,e),Jn(this,t.apply(this,arguments))}return nr(e,t),e}(lr))||hr,Sr=(dr=e.messageType(-103))(vr=function(t){function e(){return Qe(this,e),Jn(this,t.apply(this,arguments))}return nr(e,t),e}(lr))||vr,Or=(yr=e.messageType(-104))(_r=function(t){function e(){return Qe(this,e),Jn(this,t.apply(this,arguments))}return nr(e,t),e}(lr))||_r,Er=(mr=e.messageType(-105))(gr=function(t){function e(){return Qe(this,e),Jn(this,t.apply(this,arguments))}return nr(e,t),e}(lr))||gr,Ar=function(t){function e(n,r){Qe(this,e);var o=Jn(this,t.call(this));o._setConversation(n),o._peerConnection=o._createPeerConnection(r),o._call=ur(),o._promises={};var i=new Be(function(t){o._promises.resolveStreamReady=t}),c=new Be(function(t){o._promises.resolveAccept=t});return Be.all([i,c]).then(function(t){var e=Yt(t,1)[0];o._call.can("connect")&&(o._call.connect(),o.emit("connect",e))}),o}return nr(e,t),e.prototype.close=function(){var t=this;return Be.resolve().then(function(){t._call.close(),t._destroyPeerConnection(),t._peerConnection.close(),t._destroy()})},e.prototype._handleCloseEvent=function(){this._call.can("close")&&(this.close(),this.emit("close"))},e.prototype._setConversation=function(t){this._conversation&&this._conversation.off("message"),t&&(this._conversation=t,t.on("message",this._handleMessage.bind(this)))},e.prototype._destroy=function(){this._conversation.off("message")},e.prototype._createPeerConnection=function(t){var e=new RTCPeerConnection(t);return e.onicecandidate=this._handleICECandidateEvent.bind(this),e.onaddstream=this._handleAddStreamEvent.bind(this),e.onnremovestream=this._handleRemoveStreamEvent.bind(this),e.oniceconnectionstatechange=this._handleICEConnectionStateChangeEvent.bind(this),e.onsignalingstatechange=this._handleSignalingStateChangeEvent.bind(this),e},e.prototype._destroyPeerConnection=function(){var t=this._peerConnection;delete t.onaddstream,delete t.onremovestream,delete t.onnicecandidate,delete t.oniceconnectionstatechange,delete t.onsignalingstatechange},e.prototype._handleMessage=function(t){return t instanceof Cr?this._handleAnswer(t):t instanceof Or?this._handleRefusal():t instanceof Er?this._handleCancelation():t instanceof Sr&&this._handleICECandidate(t)},e.prototype._handleICECandidate=function(t){var e=new RTCIceCandidate(t.payload);this._peerConnection&&this._peerConnection.addIceCandidate(e).catch(console.error.bind(console))},e.prototype._handleICECandidateEvent=function(t){return!(!t.candidate||!this._conversation)&&this._conversation.send(new Sr(t.candidate)).catch(console.error.bind(console))},e.prototype._handleAddStreamEvent=function(t){this._promises.resolveStreamReady(t.stream)},e.prototype._handleRemoveStreamEvent=function(){this._handleCloseEvent()},e.prototype._handleICEConnectionStateChangeEvent=function(){switch(this._peerConnection.iceConnectionState){case"closed":case"failed":case"disconnected":this._handleCloseEvent()}},e.prototype._handleSignalingStateChangeEvent=function(){switch(this._peerConnection.signalingState){case"closed":this._handleCloseEvent()}},e.prototype._handleAnswer=function(){throw new Error("not implemented")},e.prototype._handleRefusal=function(){throw new Error("not implemented")},e.prototype._handleCancelation=function(){throw new Error("not implemented")},sr(e,[{key:"state",get:function(){return this._call.current}}]),e}(rr),Tr=function(t){function e(n,r,o){Qe(this,e);var i=Jn(this,t.call(this,r,o));return i.to=n,i}return nr(e,t),e.prototype._handleAnswer=function(t){var e=new RTCSessionDescription(t.payload);this._peerConnection.setRemoteDescription(e),this._promises.resolveAccept()},e.prototype._handleRefusal=function(){this._destroyPeerConnection(),this._call.refuse(),this.emit("refuse"),this._destroy()},e.prototype.cancel=function(){var t=this;return this._call.cancel(),this._conversation.send(new Er).then(function(){return t._destroy()})},e.prototype.close=function(){return this._call.can("cancel")?this.cancel():t.prototype.close.call(this)},e}(Ar),Pr=function(t){function e(n,r,o){Qe(this,e);var i=Jn(this,t.call(this,r,o));i.from=n.from;var c=new RTCSessionDescription(n.payload);return i._handleOfferPromise=i._peerConnection.setRemoteDescription(c),i}return nr(e,t),e.prototype.accept=function(t){var e=this;if(!t)throw new TypeError("a MediaStream instance is required to accept a call");return this._handleOfferPromise.then(function(){return e._peerConnection.addStream(t)}).then(function(){return e._peerConnection.createAnswer()}).then(function(t){return e._peerConnection.setLocalDescription(t)}).then(function(){return e._conversation.send(new Cr(e._peerConnection.localDescription))}).then(function(){return e._promises.resolveAccept()})},e.prototype.refuse=function(){var t=this;return this._conversation.send(new Or).then(function(){t._call.refuse(),t._destroy()})},e.prototype._handleCancelation=function(){this._call.cancel(),this.emit("cancel"),this._destroy()},e}(Ar),jr=(br=e.messageType(-101))(wr=function(t){function e(){return Qe(this,e),Jn(this,t.apply(this,arguments))}return nr(e,t),e}(lr))||wr,xr={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302","stun:stun.ekiga.net","stun:stun.ideasip.com","stun:stun.rixtelecom.se","stun:stun.schlund.de","stun:stun.stunprotocol.org:3478","stun:stun.voiparound.com","stun:stun.voipbuster.com","stun:stun.voipstunt.com","stun:stun.voxgratia.org"]}]},Lr=function(t){function e(n,r){if(Qe(this,e),"string"!=typeof n)throw new TypeError("id is not a string");var o=Jn(this,t.call(this));return o.id=n,o.options=ze({RTCConfiguration:xr},r),o}return nr(e,t),e.prototype._open=function(t,e){var n=this;return t.createIMClient(this.id,e,"webrtc").then(function(t){return n._imClient=t,n.id=t.id,t.on("message",function(t,e){return t instanceof jr&&n._handleOffer(t,e)}),t.on("conflict",function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return n.emit.apply(n,["conflict"].concat(e))}),n})},e.prototype.close=function(){return this._imClient.close()},e.prototype.call=function(t,e){var n=this;if("string"!=typeof t)throw new TypeError("target id is not a string");if(!e)throw new TypeError("a MediaStream instance is required to make a call");return this._imClient.ping([t]).then(function(r){if(!r.length)throw new Error("Call failed as "+t+" is not online");var o=new Tr(t,null,n.options.RTCConfiguration),i=new Be(function(t){o._peerConnection.onnegotiationneeded=t});return o._peerConnection.addStream(e),i.then(function(){return Be.all([n._imClient.createConversation({members:[t],unique:!0}),o._peerConnection.createOffer().then(function(t){o._peerConnection.setLocalDescription(t)})])}).then(function(t){var e=Yt(t,1)[0];return o._setConversation(e),e.send(new jr(o._peerConnection.localDescription))}).then(function(){return o})})},e.prototype._handleOffer=function(t,e){var n=new Pr(t,e,this.options.RTCConfiguration);this.emit("call",n)},e}(rr),Ir={name:"leancloud-realtime-plugin-webrtc",messageClasses:[jr,Cr,Sr,Or,Er],onRealtimeCreate:function(t){t.createWebRTCClient=function(e,n){return new Lr(e)._open(t,n)}}},Mr=!!(window.RTCPeerConnection&&window.RTCSessionDescription&&window.RTCIceCandidate);t.WebRTCPlugin=Ir,t.isWebRTCSupported=Mr,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=webrtc.min.js.map